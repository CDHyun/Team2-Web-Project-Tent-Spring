<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.springlec.base.dao.PurchaseDao">

	<select id="purchaseInfoDao" resultType="com.springlec.base.model.Purchase">
		SELECT * 
		FROM user u, userAddress ua 
		WHERE u.uid = ua.uid and u.uid = #{uid}
	</select>

	<insert id="purchaseInsert">
		INSERT INTO purchase (uid, pCode, pcInsertDate, pcQty, pcDM, pColor, pcPay)
		VALUES (#{uid}, #{pCode}, #{pcInsertDate}, #{pcQty}, #{pcDM}, #{pColor}, #{pcPay})
	</insert>

	<select id="purchaseCheck" resultType="com.springlec.base.model.Purchase">
		SELECT p.pName, p.pPrice, pf.pfRealName, pf.pfHoverRealName
		FROM user u, purchase pc
		WHERE u.uid = pc.uid and u.uid = #{uid}
	</select>

	<select id="purchaseComplete" resultType="com.springlec.base.model.Purchase">
		SELECT u.uid, pc.pcstatus
		FROM user u, purchase pc
		WHERE u.uid = pc.uid and u.uid = #{uid}
	</select>

	<select id="purchaseList" resultType="com.springlec.base.model.Purchase">
		SELECT pc.pcNo, p.pCode, p.pName, p.pPrice, pc.pcQty, pc.pcStatus, pc.pcInsertDate, u.uPhone, pf.pfRealName, pf.pfHoverRealName, pcPay
		FROM product p, user u, purchase pc, productfile pf
		WHERE pc.pCode = p.pCode AND pf.pCode = p.pCode AND u.uid = pc.uid AND pc.pcDeleted = 0 AND u.uid = #{uid}
		ORDER BY pc.pcInsertDate DESC
		LIMIT 0, 7
	</select>
	
	<select id="getProductInfo" resultType="com.springlec.base.model.Purchase">
		SELECT * FROM product p, productFile pf WHERE p.pCode = pf.pCode AND p.pCode = #{pCode}
	</select>
	
	<select id="purchaseDetailList" resultType="com.springlec.base.model.Purchase">
	SELECT pc.pcNo, pc.pcinsertDate, p.pName, u.uPhone, pf.pfRealName, pc.pcPay, pc.pcQty, p.pPrice, pc.pcDM, u.uName
	FROM product p, purchase pc, productfile pf, user u
	WHERE p.pCode = pc.pCode AND p.pCode = pf.pCode AND u.uid = #{uid} AND pcNo = #{pcNo}
	</select>
	

	<update id="modifyaddress">
		UPDATE userAddress 
		SET uaAddress = #{uaAddress}, uaDetailAddress = #{uaDetailAddress}, uaZipcode = #{uaZipcode}, uaContent = #{uaContent}
		WHERE uid = #{uid} AND uaNo = #{uaNo}
	</update>

	
	
</mapper>
