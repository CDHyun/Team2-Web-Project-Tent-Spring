<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.springlec.base.dao.AdminDao">
	<!-- 상품관리  -->
	<select id="selectlist" resultType="com.springlec.base.model.Admin">
		SELECT p.pCode, p.pBrandName, p.pName ,po.pColor, p.pPrice, po.pStock, p.pinsertdate, pf.pfName, pf.pfRealName  
		FROM product p, productoption po, productfile pf 
		WHERE p.pCode = po.pCode and p.pCode = pf.pCode and p.pDeleted=0 
	</select>
	<!-- 검색  -->
	<select id="querySelect" resultType="com.springlec.base.model.Admin">
		SELECT p.pCode, p.pBrandName, p.pName ,po.pColor, p.pPrice, po.pStock, p.pinsertdate, pf.pfName, pf.pfRealName  
		FROM product p, productoption po, productfile pf 
		WHERE p.pCode = po.pCode and p.pCode = pf.pCode and p.pDeleted=0 and ${query} like #{content}
	</select>
	<!-- 날짜별 매출 계산  -->
	<select id="dailySale" resultType="com.springlec.base.model.Admin">
		SELECT pc.pcInsertDate, p.pBrandName, p.pName, pc.pcQty, pc.pcQty*p.pPrice 
		FROM product p, purchase pc 
		WHERE p.pCode = pc.pCode and pc.pcInsertDate between #{startDate} and #{endDate} order by pc.pcInsertDate
	</select>
		
	<!-- 막대차트그리기 - SET sql_mode 포함 -->
	<sql id="setSqlMode">
	  <![CDATA[
	    SET sql_mode = (SELECT REPLACE(@@sql_mode, 'ONLY_FULL_GROUP_BY', ''));
	  ]]>
	</sql>
	
	<!-- 막대차트 -->
	<select id="chart" resultType="com.springlec.base.model.Admin">
	  <include refid="setSqlMode" />
	  <![CDATA[
	  SELECT DAYNAME(pc.pcInsertDate) , SUM(p.pPrice * pc.pcQty) 
	  FROM purchase pc, product p
	  GROUP BY DAYNAME(pc.pcInsertDate)
	  ORDER BY FIELD(DAYNAME(pc.pcInsertDate), 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday')
	  ]]>
	</select>


	<!-- 상품관리  -->
	<select id="sharelist" resultType="com.springlec.base.model.Admin">
		SELECT p.pCode, p.pBrandName, p.pName ,po.pColor, p.pPrice, po.pStock, p.pinsertdate, pf.pfName, pf.pfRealName  
		FROM product p, productoption po, productfile pf 
		WHERE p.pCode = po.pCode and p.pCode = pf.pCode and p.pDeleted=0 
	</select>
	<!-- 상품수정  -->
	<select id="contentviewDao" resultType="com.springlec.base.model.Admin">
		SELECT p.pCode, p.pBrandName, p.pName ,po.pColor, p.pPrice, po.pStock, p.pupdatedate,pf.pfName, pf.pfRealName  
		FROM product p, productoption po, productfile pf 
		WHERE p.pCode = po.pCode and p.pCode = pf.pCode and p.pCode=#{pCode} and po.pColor = #{pColor}
	</select>
	<!-- 상품등록  -->
	<insert id="insert1">
	 INSERT INTO product (pName, pBrandName, pPrice, pInsertDate, cgNo) VALUES (#{pName}, #{pBrandName}, #{pPrice}, NOW(), #{cgNo})
	 </insert>
	<insert id="insert2">
	 INSERT INTO productoption (pCode,pStock,pColor) SELECT  #{pCode}, #{pStock},#{pColor} FROM product p,productoption po WHERE pName= #{pName} and po.pCode = p.pCode
	 </insert>
	
	
	<!-- 상품사진등록  -->
	<insert id="upload">
	 INSERT INTO productfile (pfName, pfRealName,pfHoverName,pfHoverRealName, pCode) 
	 SELECT #{pfName}, #{pfRealName}, #{pfHoverName},#{pfHoverRealName},#{pCode} FROM product p LIMIT 1
	 </insert>
	 
	 
	 <!-- 주문상태  -->
	<select id="statusCheck" resultType="com.springlec.base.model.Admin">
		SELECT pc.pcNo, pc.uid, pc.pCode, po.pColor, pc.pcQty, pc.pcInsertDate, pc.pcStatus FROM purchase pc, product p, productoption po
		WHERE p.pCode = pc.pCode and p.pCode = po.pCode and po.pCode = pc.pCode and pc.pColor = po.pColor order by pc.pcNo desc
	</select>
	 <!-- 주문상태  -->
	 <update id="changeStatus">
	 	UPDATE product p, productoption po SET pDeleteDate=now() ,pDeleted =1 WHERE p.pCode = #{pCode} and po.pColor = #{pColor}
	 </update>
	 
	 
	 <!-- 고객관리 notice -->
	<select id="customer" resultType="com.springlec.base.model.Admin">
		SELECT n.nNo, n.aid, n.nTitle, n.nInsertDate FROM notice n, admin a WHERE n.aid = a.aid and n.nCgNo=1
	</select>
	
	<!-- 고객관리 faq -->
	<select id="faq" resultType="com.springlec.base.model.Admin">
		SELECT n.nNo, n.aid, n.nTitle, n.nInsertDate, n.nContent FROM notice n, admin a WHERE n.aid = a.aid and n.nCgNo=2
	</select>
	
	<!-- 상품삭제 -->
	<update id="deleteProduct">
		UPDATE product p, productoption po SET pDeleteDate=now() ,pDeleted =1 WHERE p.pCode = #{pCode} and po.pColor = #{pColor}
	</update>
	
	
</mapper>